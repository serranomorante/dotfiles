# This config demonstrates how international characters can be mapped using
# keyd. It works by using the display server's (i.e wayland/X) compose key
# functionality in conjunction with macros to generate the glyph of interest.

# For this to work 'setxkbmap -option compose:menu' must be run after keyd has started.

# A list of compose sequences can be found in /usr/share/X11/locale/en_US.UTF-8/Compose on most systems.

[ids]
k:{{ ansible_hhkb_keyboard_id }}
k:{{ ansible_mx_keys_keyboard_id }}
k:{{ ansible_mx_keys_keyboard_id_2 }}
k:{{ ansible_rii_keyboard_device }}
k:{{ ansible_internal_keyboard_device_1 }}

[global]
disable_modifier_guard = 1

[main]
capslock = layer(control)
tab = overload(tab_as_modifier, tab)

[meta]
# Fix conflict with dwm shortcut (to toggle between current and previous tag)
tab = macro(leftalt+rightalt 50ms leftmeta+tab)
1 = macro(leftalt+rightalt 50ms leftmeta+1)
2 = macro(leftalt+rightalt 50ms leftmeta+2)
3 = macro(leftalt+rightalt 50ms leftmeta+3)
4 = macro(leftalt+rightalt 50ms leftmeta+4)
5 = macro(leftalt+rightalt 50ms leftmeta+5)
6 = macro(leftalt+rightalt 50ms leftmeta+6)
7 = macro(leftalt+rightalt 50ms leftmeta+7)
8 = macro(leftalt+rightalt 50ms leftmeta+8)
9 = macro(leftalt+rightalt 50ms leftmeta+9)
# Draw on top of the screen
z = command(/usr/local/bin/run_as_user -u {{ ansible_facts.env.USER }} $(which gromit-mpx) --toggle)
c = command(/usr/local/bin/run_as_user -u {{ ansible_facts.env.USER }} $(which gromit-mpx) --clear)
v = command(/usr/local/bin/run_as_user -u {{ ansible_facts.env.USER }} $(which gromit-mpx) --visibility)
# Pop last dunst notification
n = macro(kpasterisk+4)

[signal_type_from_clipboard]

[signal_open_kitty]

[signal_open_kitty_dmenu]

[signal_open_kitty_dmenu_recents]

[meta+shift]
# Fix conflict with dwm shortcut (to close window)
c = M-S-c
o = layer(signal_type_from_clipboard)
# Open kitty terminal
enter = layer(signal_open_kitty)

[meta+control]
# Fix conflict with dwm shortcut (to focus master)
# Use `... > /tmp/logfile 2>&1` to debug any issues
space = macro(leftalt+rightalt 50ms leftmeta+leftcontrol+space 50ms leftmeta+m 50ms leftmeta+f)

[signal_open_warpd_overlay]

[signal_escape]

[tab_as_modifier]
f = layer(signal_open_warpd_overlay)
# Simulate readline shortcuts
i = toggle(readline)
# mouseless will receive this keymap and enable mouse layer
space = macro(leftcontrol+rightcontrol)

[readline]

[readline+control]
b = left
f = right
a = home
e = end
d = delete
w = C-backspace
p = up
n = down

[readline+alt]
b = C-left
f = C-right
d = C-delete

[readline+altgr]
b = C-left
f = C-right
d = C-delete

[control]
space = oneshot(spanish)
[ = layerm(signal_escape, C-[)

[control+shift]
# Open cwd in kitty terminal
f = layer(signal_open_kitty_dmenu)
o = layer(signal_open_kitty_dmenu_recents)

[spanish]
a = command(/usr/local/bin/run_as_user -u {{ ansible_facts.env.USER }} $(which xdotool) key --clearmodifiers aacute)
e = command(/usr/local/bin/run_as_user -u {{ ansible_facts.env.USER }} $(which xdotool) key --clearmodifiers eacute)
i = command(/usr/local/bin/run_as_user -u {{ ansible_facts.env.USER }} $(which xdotool) key --clearmodifiers iacute)
o = command(/usr/local/bin/run_as_user -u {{ ansible_facts.env.USER }} $(which xdotool) key --clearmodifiers oacute)
u = command(/usr/local/bin/run_as_user -u {{ ansible_facts.env.USER }} $(which xdotool) key --clearmodifiers uacute)
n = command(/usr/local/bin/run_as_user -u {{ ansible_facts.env.USER }} $(which xdotool) key --clearmodifiers ntilde)

[spanish+shift]
a = command(/usr/local/bin/run_as_user -u {{ ansible_facts.env.USER }} $(which xdotool) key Aacute)
e = command(/usr/local/bin/run_as_user -u {{ ansible_facts.env.USER }} $(which xdotool) key Eacute)
i = command(/usr/local/bin/run_as_user -u {{ ansible_facts.env.USER }} $(which xdotool) key Iacute)
o = command(/usr/local/bin/run_as_user -u {{ ansible_facts.env.USER }} $(which xdotool) key Oacute)
u = command(/usr/local/bin/run_as_user -u {{ ansible_facts.env.USER }} $(which xdotool) key Uacute)
n = command(/usr/local/bin/run_as_user -u {{ ansible_facts.env.USER }} $(which xdotool) key Ntilde)
1 = command(/usr/local/bin/run_as_user -u {{ ansible_facts.env.USER }} $(which xdotool) key exclamdown)
4 = command(/usr/local/bin/run_as_user -u {{ ansible_facts.env.USER }} $(which xdotool) key EuroSign)
/ = command(/usr/local/bin/run_as_user -u {{ ansible_facts.env.USER }} $(which xdotool) key questiondown)
