# This config demonstrates how international characters can be mapped using
# keyd. It works by using the display server's (i.e wayland/X) compose key
# functionality in conjunction with macros to generate the glyph of interest.

# For this to work 'setxkbmap -option compose:menu' must be run after keyd has started.

# A list of compose sequences can be found in /usr/share/X11/locale/en_US.UTF-8/Compose on most systems.

[ids]
k:{{ ansible_hhkb_keyboard_id }}
k:{{ ansible_mx_keys_keyboard_id }}
k:{{ ansible_mx_keys_keyboard_id_2 }}
k:{{ ansible_rii_keyboard_device }}
k:{{ ansible_internal_keyboard_device_1 }}

[global]
disable_modifier_guard = 1

[main]
capslock = layer(control)
tab = overload(tab_as_modifier, tab)

# --- TODO remove when reaper fixes ALT issue
[alt]
d = macro(leftalt leftalt A-d)
g = macro(leftalt leftalt A-g)
m = macro(leftalt leftalt A-m)
n = macro(leftalt leftalt A-n)
r = macro(leftalt leftalt A-r)
s = macro(leftalt leftalt A-s)
t = macro(leftalt leftalt A-t)
up = macro(leftalt leftalt A-up)
left = macro(leftalt leftalt A-left)
right = macro(leftalt leftalt A-right)
down = macro(leftalt leftalt A-down)
b = macro(leftalt leftalt A-b)
c = macro(leftalt leftalt A-c)
e = macro(leftalt leftalt A-c)
l = macro(leftalt leftalt A-l)
p = macro(leftalt leftalt A-p)
s = macro(leftalt leftalt A-s)
x = macro(leftalt leftalt A-x)
z = macro(leftalt leftalt A-z)
0 = macro(leftalt leftalt A-0)
1 = macro(leftalt leftalt A-1)
2 = macro(leftalt leftalt A-2)
3 = macro(leftalt leftalt A-3)
4 = macro(leftalt leftalt A-4)
5 = macro(leftalt leftalt A-5)
6 = macro(leftalt leftalt A-6)
7 = macro(leftalt leftalt A-7)
8 = macro(leftalt leftalt A-8)
9 = macro(leftalt leftalt A-9)
- = macro(leftalt leftalt A--)

[alt+shift]
8 = macro(leftalt leftalt A-S-8)
n = macro(leftalt leftalt A-S-n)
up = macro(leftalt leftalt A-S-up)
down = macro(leftalt leftalt A-S-down)
c = macro(leftalt leftalt A-S-c)
g = macro(leftalt leftalt A-S-g)
s = macro(leftalt leftalt A-S-s)
t = macro(leftalt leftalt A-S-t)

[control+alt]
d = macro(leftalt leftalt C-A-d)
2 = macro(leftalt leftalt C-A-2)
n = macro(leftalt leftalt C-A-n)
a = macro(leftalt leftalt C-A-a)
b = macro(leftalt leftalt C-A-b)
e = macro(leftalt leftalt C-A-e)
f = macro(leftalt leftalt C-A-f)
g = macro(leftalt leftalt C-A-g)
l = macro(leftalt leftalt C-A-l)
m = macro(leftalt leftalt C-A-m)
n = macro(leftalt leftalt C-A-n)
p = macro(leftalt leftalt C-A-p)
q = macro(leftalt leftalt C-A-q)
r = macro(leftalt leftalt C-A-r)
s = macro(leftalt leftalt C-A-s)
t = macro(leftalt leftalt C-A-t)
v = macro(leftalt leftalt C-A-v)
x = macro(leftalt leftalt C-A-x)
z = macro(leftalt leftalt C-A-z)
, = macro(leftalt leftalt C-A-,)
. = macro(leftalt leftalt C-A-.)
up = macro(leftalt leftalt C-A-up)
down = macro(leftalt leftalt C-A-down)
tab = macro(leftalt leftalt C-A-tab)

[control+alt+shift]
r = macro(leftalt leftalt C-A-S-r)
s = macro(leftalt leftalt C-A-S-s)
t = macro(leftalt leftalt C-A-S-t)
up = macro(leftalt leftalt C-A-S-up)
down = macro(leftalt leftalt C-A-S-down)
tab = macro(leftalt leftalt C-A-S-tab)

# --- altgr
[altgr]
d = macro(rightalt rightalt G-d)
g = macro(rightalt rightalt G-g)
m = macro(rightalt rightalt G-m)
n = macro(rightalt rightalt G-n)
r = macro(rightalt rightalt G-r)
s = macro(rightalt rightalt G-s)
t = macro(rightalt rightalt G-t)
up = macro(rightalt rightalt G-up)
left = macro(rightalt rightalt G-left)
right = macro(rightalt rightalt G-right)
down = macro(rightalt rightalt G-down)
b = macro(rightalt rightalt G-b)
c = macro(rightalt rightalt G-c)
e = macro(rightalt rightalt G-c)
l = macro(rightalt rightalt G-l)
p = macro(rightalt rightalt G-p)
s = macro(rightalt rightalt G-s)
x = macro(rightalt rightalt G-x)
z = macro(rightalt rightalt G-z)
0 = macro(rightalt rightalt G-0)
1 = macro(rightalt rightalt G-1)
2 = macro(rightalt rightalt G-2)
3 = macro(rightalt rightalt G-3)
4 = macro(rightalt rightalt G-4)
5 = macro(rightalt rightalt G-5)
6 = macro(rightalt rightalt G-6)
7 = macro(rightalt rightalt G-7)
8 = macro(rightalt rightalt G-8)
9 = macro(rightalt rightalt G-9)
- = macro(rightalt rightalt G--)

[altgr+shift]
8 = macro(rightalt rightalt G-S-8)
n = macro(rightalt rightalt G-S-n)
up = macro(rightalt rightalt G-S-up)
down = macro(rightalt rightalt G-S-down)
c = macro(rightalt rightalt G-S-c)
g = macro(rightalt rightalt G-S-g)
s = macro(rightalt rightalt G-S-s)
t = macro(rightalt rightalt G-S-t)

[control+altgr]
d = macro(rightalt rightalt C-G-d)
2 = macro(rightalt rightalt C-G-2)
n = macro(rightalt rightalt C-G-n)
a = macro(rightalt rightalt C-G-a)
b = macro(rightalt rightalt C-G-b)
e = macro(rightalt rightalt C-G-e)
f = macro(rightalt rightalt C-G-f)
g = macro(rightalt rightalt C-G-g)
l = macro(rightalt rightalt C-G-l)
m = macro(rightalt rightalt C-G-m)
n = macro(rightalt rightalt C-G-n)
p = macro(rightalt rightalt C-G-p)
q = macro(rightalt rightalt C-G-q)
r = macro(rightalt rightalt C-G-r)
s = macro(rightalt rightalt C-G-s)
t = macro(rightalt rightalt C-G-t)
v = macro(rightalt rightalt C-G-v)
x = macro(rightalt rightalt C-G-x)
z = macro(rightalt rightalt C-G-z)
, = macro(rightalt rightalt C-G-,)
. = macro(rightalt rightalt C-G-.)
up = macro(rightalt rightalt C-G-up)
down = macro(rightalt rightalt C-G-down)
tab = macro(rightalt rightalt C-G-tab)

[control+altgr+shift]
r = macro(rightalt rightalt C-G-S-r)
s = macro(rightalt rightalt C-G-S-s)
t = macro(rightalt rightalt C-G-S-t)
up = macro(rightalt rightalt C-G-S-up)
down = macro(rightalt rightalt C-G-S-down)
tab = macro(rightalt rightalt C-G-S-tab)
# --- end TODO

[meta]
# Fix conflict with dwm shortcut (to toggle between current and previous tag)
tab = macro(leftalt+rightalt 50ms leftmeta+tab)
1 = macro(leftalt+rightalt 50ms leftmeta+1)
2 = macro(leftalt+rightalt 50ms leftmeta+2)
3 = macro(leftalt+rightalt 50ms leftmeta+3)
4 = macro(leftalt+rightalt 50ms leftmeta+4)
5 = macro(leftalt+rightalt 50ms leftmeta+5)
6 = macro(leftalt+rightalt 50ms leftmeta+6)
7 = macro(leftalt+rightalt 50ms leftmeta+7)
8 = macro(leftalt+rightalt 50ms leftmeta+8)
9 = macro(leftalt+rightalt 50ms leftmeta+9)
# Draw on top of the screen
z = command({{ xorg_display_env_vars }} $(which gromit-mpx) --toggle)
c = command({{ xorg_display_env_vars }} $(which gromit-mpx) --clear)
v = command({{ xorg_display_env_vars }} $(which gromit-mpx) --visibility)
# Pop last dunst notification
n = macro(kpasterisk+4)

[meta+shift]
# Fix conflict with dwm shortcut (to close window)
c = M-S-c
o = command(keyd do leftalt+rightalt; {{ xorg_display_env_vars }} xclip -selection clipboard -o | {{ xorg_display_env_vars }} $(which xdotool) type --clearmodifiers "$(head -c 20 </dev/stdin)")
# Open kitty terminal
enter = macro(kpasterisk+1)

[meta+control]
# Fix conflict with dwm shortcut (to focus master)
# Use `... > /tmp/logfile 2>&1` to debug any issues
space = macro(leftalt+rightalt 50ms leftmeta+leftcontrol+space 50ms leftmeta+m 50ms leftmeta+f)

[tab_as_modifier]
# Toggle warpd hint mode. Use `... > /tmp/logfile 2>&1` to debug any issues
f = command(keyd do leftalt+rightalt; {{ xorg_display_env_vars }} $(which warpd) --config {{ ansible_env.HOME }}/.config/warpd/config --hint --oneshot --foreground && keyd do leftcontrol+rightcontrol)
# Simulate readline shortcuts
i = toggle(readline)
# mouseless will receive this keymap and enable mouse layer
space = macro(leftcontrol+rightcontrol)

[readline]

[readline+control]
b = left
f = right
a = home
e = end
d = delete
w = C-backspace

[readline+alt]
b = C-left
f = C-right
d = C-delete

[readline+altgr]
b = C-left
f = C-right
d = C-delete

[control]
space = oneshot(spanish)

[control+shift]
# Open cwd in kitty terminal
f = macro(kpasterisk+2)
o = macro(kpasterisk+3)

[spanish]
a = command({{ xorg_display_env_vars }} $(which xdotool) key --clearmodifiers aacute)
e = command({{ xorg_display_env_vars }} $(which xdotool) key --clearmodifiers eacute)
i = command({{ xorg_display_env_vars }} $(which xdotool) key --clearmodifiers iacute)
o = command({{ xorg_display_env_vars }} $(which xdotool) key --clearmodifiers oacute)
u = command({{ xorg_display_env_vars }} $(which xdotool) key --clearmodifiers uacute)
n = command({{ xorg_display_env_vars }} $(which xdotool) key --clearmodifiers ntilde)

[spanish+shift]
a = command({{ xorg_display_env_vars }} $(which xdotool) key Aacute)
e = command({{ xorg_display_env_vars }} $(which xdotool) key Eacute)
i = command({{ xorg_display_env_vars }} $(which xdotool) key Iacute)
o = command({{ xorg_display_env_vars }} $(which xdotool) key Oacute)
u = command({{ xorg_display_env_vars }} $(which xdotool) key Uacute)
n = command({{ xorg_display_env_vars }} $(which xdotool) key Ntilde)
1 = command({{ xorg_display_env_vars }} $(which xdotool) key exclamdown)
4 = command({{ xorg_display_env_vars }} $(which xdotool) key EuroSign)
/ = command({{ xorg_display_env_vars }} $(which xdotool) key questiondown)
