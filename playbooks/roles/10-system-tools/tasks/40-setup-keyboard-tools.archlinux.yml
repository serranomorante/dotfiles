---
- name: "Keyboard peripheral: ensure sxhkd is present"
  become: true
  ansible.builtin.package:
    state: present
    name: sxhkd

- name: "Keyboard peripheral: enable service sxhkd and ensure is not masked"
  ansible.builtin.systemd_service:
    scope: user
    state: started
    name: sxhkd
    enabled: true
    masked: false

- name: "Keyboard peripheral: ensure keyd is present"
  ansible.builtin.package:
    state: present
    name: keyd

- name: "Keyboard peripheral: enable services"
  ansible.builtin.systemd_service:
    scope: "{{ service.scope }}"
    name: "{{ service.name }}"
    state: started
    enabled: true
    masked: false
  loop:
    - { name: keyd, scope: system }
    - { name: kbdrate, scope: user }
  loop_control:
    loop_var: service

- name: "Keyboard peripheral: copy sudo files"
  become: true
  ansible.builtin.copy:
    src: "{{ item.source }}"
    dest: "{{ item.dest }}"
    owner: root
    mode: "644"
  loop:
    - { source: ~/.config/keyd/default.conf, dest: /etc/keyd/default.conf }
    - { source: ~/dotfiles/assets/udev-rules/99-kbdrate.rules, dest: /etc/udev/rules.d/99-kbdrate.rules }
