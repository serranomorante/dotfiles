---
- name: "Keyboard peripheral: ensure sxhkd is present"
  become: true
  ansible.builtin.package:
    state: present
    name: sxhkd

- name: "Keyboard peripheral: enable service sxhkd and ensure is not masked"
  ansible.builtin.systemd_service:
    scope: user
    state: started
    name: sxhkd
    enabled: true
    masked: false

- name: "Keyboard peripheral: ensure keyd is present"
  ansible.builtin.package:
    state: present
    name: keyd

- name: "Keyboard peripheral: enable service keyd and ensure is not masked"
  ansible.builtin.systemd_service:
    scope: "{{ service.scope }}"
    name: "{{ service.name }}"
    state: started
    enabled: true
    masked: false
  loop:
    - { name: keyd, scope: system }
    - { name: keyd-compose, scope: user }
  loop_control:
    loop_var: service

- name: "Keyboard peripheral: copy keyd default.conf file"
  become: true
  ansible.builtin.copy:
    src: ~/.config/keyd/default.conf
    dest: /etc/keyd/default.conf
    owner: root
    mode: "644"

- name: "Keyboard peripheral: enable kbdrate service"
  ansible.builtin.systemd_service:
    scope: user
    name: kbdrate
    state: started
    enabled: true
    masked: false
